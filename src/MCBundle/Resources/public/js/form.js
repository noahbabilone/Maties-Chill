var cache = {};$(function () {    $(".modality").change(function () {        console.log($(this).val());        switch ($(this).val()) {            case '1': //gratuit                $('#input_price').addClass("hide");                $('#input_contribution').addClass("hide");                break;            case '2' : //contribution                $('#input_price').addClass("hide");                $('#input_contribution').removeClass("hide");                break;            case '3' : // payant                $('#input_price').removeClass("hide");                $('#input_contribution').addClass("hide");                break;            case '4' : //payant avec contribution                $('#input_price').removeClass("hide");                $('#input_contribution').removeClass("hide");                break;        }    });    $("#search_film").keyup(function () {        // console.log($(this).val().length);        if ($(this).val().length > 2) {            $("#btn_search_film").prop('disabled', false);        } else {            $("#btn_search_film").prop('disabled', true);        }    });    $("#search_film").change(function () {        $("#icon_search_film").removeClass("fa-spin").removeClass("fa-spinner").addClass("fa-film");        if (!$(this).val()) {            $('.input_film').val("");        }        if ($(this).val().length < 2) {            $("#btn_search_film").prop('disabled', true);        }    });    $("#search_film").autocomplete({        //source: availableTags        source: function (request, response) {            //Si la réponse est dans le cache            if (request.term in cache) {                response($.map(cache[request.term], function (item) {                    console.log(item);                    return {                        label: item.title,//+ ", " + item.code,                        value: function () {                            $("#search_film").val(item.title);                            $('#film_info').removeClass('hide');                            $(".film_title").html(item.title);                            $("#search_film").attr("data-value", item.code);                            $('.input_film').val(item.code);                            if (item.directors) {                                $(".film_directors").html(item.directors);                                $(".tr_film_directors").removeClass('hide');                            }                            if (item.date) {                                $(".film_year").html(item.date);                                $(".tr_film_year").removeClass('hide');                            }                            if (item.actors) {                                $(".film_actors").html(item.actors);                                $(".tr_film_actors").removeClass('hide');                            }                            if (item.genre) {                                $(".film_genre").html(item.genre);                                $(".tr_film_genre").removeClass('hide');                            }                            if (item.synopsis) {                                $(".film_synopsis").html(item.synopsis);                                $(".tr_film_synopsis").removeClass('hide');                            }                            if (item.allocine) {                                $("#btn_allocine").val(item.allocine);                                $("#btn_allocine").removeClass('hide');                            } else {                                $("#btn_allocine").addClass('hide');                                $("#btn_allocine").val('');                            }                            if (item.poster) {                                $("#film_poster").attr("src", item.poster);                            } else {                                $("#film_poster").attr("src", $("#film_poster_default").attr("src"));                            }                            return item.title;                        }                    };                }));            } else {                var href = Routing.generate('search_film_ajax');                var data = {search: $.trim($("#search_film").val())};                // $.getJSON(href, data)                $.ajax({                    url: href,                    dataType: "json",                    data: data,                    type: 'GET',                    beforeSend: function () {                        $("#btn_icon_search").removeClass("fa-search")                            .addClass("fa-spin")                            .addClass("fa-spinner");                    }                }).done(function (data) {                    $("#btn_icon_search")                        .removeClass("fa-spin")                        .removeClass("fa-spinner")                        .addClass("fa-search");                    if (data.response == "success") {                        if (!data.result.length) {                            var result = [                                {                                    label: 'Aucun film trouvé',                                    value: response.term                                }                            ];                            response(result);                        } else {                            // console.log(data);                            cache[request.term] = data.result;                            // console.log(data.result);                            response($.map(data.result, function (item) {                                // console.log(item);                                return {                                    label: item.title,// + "(" + item.code + ")",                                    avatar: item.poster,                                    value: function () {                                        // console.log(item);                                        $("#search_film").val(item.title);                                        $('#film_info').removeClass('hide');                                        $(".film_title").html(item.title);                                        $("#search_film").attr("data-value", item.code);                                        $('.input_film').val(item.code);                                        if (item.directors) {                                            $(".film_directors").html(item.directors);                                            $(".tr_film_directors").removeClass('hide');                                        }                                        if (item.date) {                                            $(".film_year").html(item.date);                                            $(".tr_film_year").removeClass('hide');                                        }                                        if (item.actors) {                                            $(".film_actors").html(item.actors);                                            $(".tr_film_actors").removeClass('hide');                                        }                                        if (item.genre) {                                            $(".film_genre").html(item.genre);                                            $(".tr_film_genre").removeClass('hide');                                        }                                        if (item.synopsis) {                                            $(".film_synopsis").html(item.synopsis);                                            $(".tr_film_synopsis").removeClass('hide');                                        }                                        if (item.allocine) {                                            $("#btn_allocine").val(item.allocine);                                            $("#btn_allocine").removeClass('hide');                                        } else {                                            $("#btn_allocine").addClass('hide');                                            $("#btn_allocine").val('');                                        }                                        if (item.poster) {                                            $("#film_poster").attr("src", item.poster);                                        } else {                                            $("#film_poster").attr("src", $("#film_poster_default").attr("src"));                                        }                                        return item.title;                                    }                                };                            }));                        }                    }                });            }        },        minLength: 2,        delay: 10    }).data("uiAutocomplete")._renderItem = function (ul, item) {        var $img = $('<img>');        $img.attr({            src: item.avatar,            alt: item.label        }).addClass('autocomplete-image');        var $li = $('<li>'),            $link = $('<a href="#"  data-toggle="tooltip" >');        $link.append($img).append(item.label);        $li.attr('data-value', item.label);        $li.append($link);        return $li.appendTo(ul);    };    $('.btn-add-user').click(function (e) {        $('.input_date_session').val($("#input_date_session").val());        //e.preventDefault();    });    $('#btn_search_film').click(function (e) {        var search = $.trim($("#search_film").val());        if (search.length > 2) {            $("#modal_input_search_film").val(search);            console.log(search);            searchFilmAjax(search);            $('#modal_search_film').modal();        }        e.preventDefault();    });    $('#btn_modal_search_film').click(function (e) {        var search = $.trim($("#modal_input_search_film").val());        alert(search);        if (search.length > 2) {            searchFilmAjax(search);            // $('#modal_search_film').modal();        }        e.preventDefault();    });    function searchFilmAjax(search) {        $("#result_film").html("");        var $row = $('<div class="row">');        var href = Routing.generate('search_film_ajax');        var data = {search: search, count: 24};        $.ajax({            url: href,            dataType: "json",            data: data,            type: 'GET',            beforeSend: function () {                $("#icon_search_film").removeClass("fa-film")                    .addClass("fa-spin")                    .addClass("fa-spinner");            }        }).done(function (data) {            $("#icon_search_film")                .removeClass("fa-spin")                .removeClass("fa-spinner")                .addClass("fa-film");            if (data.response == "success") {                console.log(data);                $.each(data.result, function (key, video) {                    if (video.poster != null && video.title != null) {                        var $col = $('<div class="col-sm-2 text-center margin-bottom-10">');                        var $img = $('<img src="' + video.poster + '"  tile="' + video.title + '" class="image-responsive" height="160" width="120" />');                        var $link = $("<a href=''>");                        $link.append($img);                        $link.click(function (e) {                            $("#search_film").val(video.title);                            $('#film_info').removeClass('hide');                            $(".film_title").html(video.title);                            $("#search_film").attr("data-value", video.code);                            $('.input_film').val(video.code);                            if (video.directors) {                                $(".film_directors").html(video.directors);                                $(".tr_film_directors").removeClass('hide');                            }                            if (video.date) {                                $(".film_year").html(video.date);                                $(".tr_film_year").removeClass('hide');                            }                            if (video.actors) {                                $(".film_actors").html(video.actors);                                $(".tr_film_actors").removeClass('hide');                            }                            if (video.genre) {                                $(".film_genre").html(video.genre);                                $(".tr_film_genre").removeClass('hide');                            }                            if (video.synopsis) {                                $(".film_synopsis").html(video.synopsis);                                $(".tr_film_synopsis").removeClass('hide');                            }                            if (video.allocine) {                                $("#btn_allocine").val(video.allocine);                                $("#btn_allocine").removeClass('hide');                            } else {                                $("#btn_allocine").addClass('hide');                                $("#btn_allocine").val('');                            }                            if (video.poster) {                                $("#film_poster").attr("src", video.poster);                            } else {                                $("#film_poster").attr("src", $("#film_poster_default").attr("src"));                            }                            $('#modal_search_film').modal('hide');                            e.preventDefault();                            return false;                        });                        $col.html($link);                        $row.append($col);                        $("#result_film").append($row);                    }                });                // console.log($row);            } else {                $("#result_film").append($row.append('<h4> Aucun film trouvé.</h4>'));            }        });    }    $('#btn_allocine').click(function (e) {        var url = $(this).val();        if (url) {            window.open(url, '_blank');        } else {            e.preventDefault();            console.log('No Url');        }    });});