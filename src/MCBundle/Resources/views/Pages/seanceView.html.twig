{% extends "MCBundle::main.html.twig" %}{% trans_default_domain 'FOSUserBundle' %}{% block title %}    Films - {{ parent() }}{% endblock %}{% block stylesheets %}    {{ parent() }}    {% stylesheets    'https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css'    'bundles/mc/css/jquery.rateyo.css'    'bundles/mc/css/card.css'    'bundles/mc/themes/global/plugins/cubeportfolio/css/cubeportfolio.css'    'bundles/mc/themes/pages/css/portfolio.min.css'    filter='cssrewrite' %}    <link rel="stylesheet" href="{{ asset_url }}"/>    {% endstylesheets %}{% endblock %}{% block body_mc %}    <div class="page-container page-mc">        <div class="page-content">            <div class="page-bar">                <div class="row">                    <div class="col-sm-12">                        <ul class="page-breadcrumb">                            <li>                                <a href="{{ path('home_page') }}">Accueil</a>                                <i class="fa fa-circle"></i>                            </li>                            <li>                                <a href="{{ path('seances_home') }}">Séances</a>                                <i class="fa fa-circle"></i>                            </li>                            {% if seance is defined  and seance %}                                <li>                                    <span>{{ seance.film.title | capitalize }}                                        de {{ seance.creator.username | capitalize }}</span>                                </li>                            {% endif %}                        </ul>                    </div>                </div>            </div>            <!-- END PAGE BAR -->            <!-- BEGIN PAGE TITLE-->            <div class="row">                <div class="col-sm-2">                    {% include("MCBundle:Includes:submenu.html.twig") %}                </div>                {% if seance is defined and seance %}                    <div class="col-sm-10">                        <div class="row">                            <div class="col-sm-12">                                {% if response is defined  and message is defined %}                                    {% if response == "success" %}                                        <div class="note note-success">                                            <h5><b>Success :</b> {{ message }} </h5>                                        </div>                                    {% else %}                                        <div class="note note-warning">                                            <h5><b>ERREUR :</b> {{ message }} </h5>                                        </div>                                    {% endif %}                                {% endif %}                            </div>                            <div class="col-sm-12">                                <h3 class="page-title page-header">                                    Séance                                    <small> {{ seance.film.title | capitalize }} - {{ seance.typeView | upper }}                                        - {{ seance.creator.username | capitalize }} </small>                                </h3>                            </div>                            <div class="col-sm-9">                                {% if seance.film.title is defined %}                                    <h3 class="page-title font-green sbold uppercase">{{ seance.film.title }}                                        - {{ seance.typeView }}</h3>                                {% endif %}                                <div class="profile">                                    <div class="tabbable-line tabbable-full-width">                                        <ul class="nav nav-tabs">                                            <li class="active">                                                <a href="#seance_info" data-toggle="tab"> Séance </a>                                            </li>                                            <li>                                                <a href="#film_info" data-toggle="tab"> Film </a>                                            </li>                                        </ul>                                        <div class="tab-content">                                            <div class="tab-pane active" id="seance_info">                                                <div class="table-scrollable table-scrollable-borderless">                                                    <table class="table table-hover table-light">                                                        {% if seance.creator is defined and seance.creator %}                                                            <tr>                                                                <td class="">Proposé(e) par:</td>                                                                <td class="">{{ seance.creator.username | capitalize }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.date is defined and seance.date %}                                                            <tr>                                                                <td class="col-sm-2">Durée</td>                                                                <td class="col-sm-9">                                                                    {{ seance.date| date("d F") }}                                                                    à {{ seance.date| date("H") }}                                                                    h {{ seance.date| date("i") }}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.address.town is defined and seance.address.town %}                                                            <tr>                                                                <td class="col-sm-2">Ville</td>                                                                <td class="col-sm-9">{{ seance.address.town | capitalize }}                                                                    {% if seance.address.postCode is defined and seance.address.postCode %}                                                                        ({{ seance.address.postCode }})                                                                    {% endif %}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.directors is defined and seance.film.directors %}                                                            <tr>                                                                <td class="col-sm-2">Réalisateur</td>                                                                <td class="col-sm-9">{{ seance.film.directors }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.price is defined and seance.price %}                                                            <tr>                                                                <td class="col-sm-2">Prix</td>                                                                <td class="col-sm-9">                                                                    {% if seance.price > 0 %}{{ seance.price }}€{% else %}Gratuit{% endif %}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.contribution is defined and seance.contribution %}                                                            <tr>                                                                <td class="col-sm-2">Avec contribution</td>                                                                <td class="col-sm-9">{{ seance.contribution | capitalize }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.maxPlace is defined and seance.maxPlace %}                                                            <tr>                                                                <td class="col-sm-2">Place(s) Rts</td>                                                                {% if participants is defined %}                                                                    <td class="col-sm-9">{{ seance.maxPlace - participants }}</td>                                                                {% else %}                                                                    <td class="col-sm-9">{{ seance.maxPlace }}</td>                                                                {% endif %}                                                            </tr>                                                        {% endif %}                                                        {% if participants is defined %}                                                            <tr>                                                                <td class="col-sm-2">Participant(s)</td>                                                                <td class="col-sm-9">                                                                    {% if participants == 0 %}                                                                        Aucun participant                                                                    {% else %}                                                                        {{ participants }}                                                                    {% endif %}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.material is defined and seance.material %}                                                            <tr>                                                                <td class="col-sm-2">Autre</td>                                                                <td class="col-sm-9">                                                                    {% for material in seance.material %}                                                                        {{ material.title }}                                                                        {% if loop.index < seance.material | length %}/{% endif %}                                                                    {% endfor %}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.description is defined and seance.description %}                                                            <tr>                                                                <td class="col-sm-2">Autre</td>                                                                <td class="col-sm-9">{{ seance.description | capitalize }}</td>                                                            </tr>                                                        {% endif %}                                                    </table>                                                </div>                                            </div>                                            <div class="tab-pane" id="film_info">                                                <div class="table-scrollable table-scrollable-borderless">                                                    <table class="table table-hover table-light">                                                        {% if seance.film.releaseDate is defined and seance.film.releaseDate %}                                                            <tr>                                                                <td class="">Date de sortie</td>                                                                <td class="">{{ seance.film.releaseDate | date("d F Y") }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.runtime is defined and seance.film.runtime %}                                                            <tr>                                                                <td class="col-sm-2">Durée</td>                                                                <td class="col-sm-9">                                                                    {{ seance.film.runtime | date("g") }}                                                                    h {{ seance.film.runtime | date("i") }}min                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.nationality is defined and seance.film.nationality %}                                                            <tr>                                                                <td class="col-sm-2">Nationalité</td>                                                                <td class="col-sm-9">{{ seance.film.nationality | capitalize }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.directors is defined and seance.film.directors %}                                                            <tr>                                                                <td class="col-sm-2">Réalisateur</td>                                                                <td class="col-sm-9">{{ seance.film.directors }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.actors is defined and seance.film.actors %}                                                            <tr>                                                                <td class="col-sm-2">Avec</td>                                                                <td class="col-sm-9">{{ seance.film.actors }}</td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.genre is defined and seance.film.genre %}                                                            <tr>                                                                <td class="col-sm-2">Genre(s)</td>                                                                <td class="col-sm-9">                                                                    {% for genre in seance.film.genre %}                                                                        {{ genre.title }}                                                                        {% if loop.index < seance.film.genre |length %}/{% endif %}                                                                    {% endfor %}                                                                </td>                                                            </tr>                                                        {% endif %}                                                        {% if seance.film.pressRating is defined and seance.film.pressRating %}                                                            <tr>                                                                <td class="col-sm-2">Notes Presses</td>                                                                <td class="col-sm-9">                                                    <span id="pressRating"                                                          data-rating="{{ seance.film.pressRating | round(1, 'floor') }}">{{ seance.film.pressRating | round(1, 'floor') }}</span>                                                                </td>                                                            </tr>                                                            {#<input class="kv-svg rating-loading"#}                                                            {#value="{{ seance.film.pressRating | round(1, 'floor') }}"#}                                                            {#data-size="xs" title="Notes Presses">#}                                                        {% endif %}                                                        {% if seance.film.userRating is defined and seance.film.userRating %}                                                            <tr>                                                                <td class="col-sm-2">Notes Spetacteurs</td>                                                                <td class="col-sm-9">                                                    <span id="userRating"                                                          data-rating="{{ seance.film.userRating | round(1, 'floor') }}">{{ seance.film.userRating | round(1, 'floor') }}</span>                                                                </td>                                                            </tr>                                                        {% endif %}                                                    </table>                                                    {#{% if seance.film.trailer is defined and seance.film.trailer %}#}                                                    {#<div id='ACEmbed'>#}                                                    {#<div class="embed-responsive embed-responsive-16by9">#}                                                    {#<iframe class="embed-responsive-item"#}                                                    {#src='{{ seance.film.trailer }}'#}                                                    {#frameborder='0'#}                                                    {#allowfullscreen='true'></iframe>#}                                                    {#<br/>#}                                                    {#</div>#}                                                    {#</div>#}                                                    {#{% endif %}#}                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                                {% if seance.film.synopsis is defined %}                                    <h3 class="caption font-yellow-casablanca sbold">Synopsis</h3>                                    <p class="">{{ seance.film.synopsis | capitalize }}</p>                                {% endif %}                                <ul class="list-inline">                                    {% if seance.creator is defined and seance.creator %}                                        <li>                                            <i class="fa fa-user"></i> {{ seance.creator.username | capitalize }}                                        </li>                                    {% endif %}                                    {% if seance.date is defined and seance.date %}                                        <li>                                            <i class="fa fa-calendar"></i> {{ seance.date | date("d F") }}                                        </li>                                        <li>                                            <i class="fa fa-clock-o"></i> {{ seance.date| date("H") }}                                            h{{ seance.date| date("i") }}                                        </li>                                    {% endif %}                                    {% if seance.address.town is defined and seance.address.town %}                                        <li>                                            <i class="fa fa-map-marker"></i>                                            {{ seance.address.town }}                                            {% if seance.address.postCode is defined and seance.address.postCode %}                                                ({{ seance.address.postCode }})                                            {% endif %}                                        </li>                                    {% endif %}                                    {% if participants is defined %}                                        <li>                                            <i class="fa fa-heart"></i>                                            {{ participants }}                                        </li>                                    {% endif %}                                    {% if seance.film.userRating is defined and seance.film.pressRating %}                                        <li>                                            <i class="fa fa-star"></i>                                            {% set rating = (seance.film.userRating+ seance.film.pressRating)/2 %}                                            {{ rating | round(1, 'floor') }}                                        </li>                                    {% endif %}                                    {% if seance.address.town is defined and seance.address.town %}                                        <li>                                            <i class="fa fa-shopping-cart"></i>                                            {{ seance.price }}<i class="fa fa-eur"></i>                                        </li>                                    {% endif %}                                </ul>                            </div>                            <div class="col-sm-3">                                <div id="js-grid-juicy-projects" class="cbp">                                    <div class="cbp-item graphic">                                        {% if isParticipant is defined and isParticipant  == true %}                                            <div class="btn-group btn-group btn-group-justified">                                                <a href="javascript:;"                                                   data-action="btn-message"                                                   class="btn blue btn-sm btn-block">                                                    <i class="fa fa-shopping-cart"></i> Payer                                                </a>                                                <a href="javascript:;"                                                   data-action="btn-message"                                                   class="btn yellow-crusta btn-sm btn-block">                                                    <i class="fa fa-remove"></i> Rectracter                                                </a>                                            </div>                                        {% endif %}                                        {% if seance.film.poster is defined and seance.film.poster %}                                            <a href="{{ seance.film.poster }}" class="cbp-lightbox">                                                <img src="{{ seance.film.poster }}"                                                     class="img-responsive pic-bordered thumbnail margin-right "                                                     alt=""/>                                            </a>                                        {% else %}                                            <img src="../../../uploads/images/400x300.png"                                                 class="img-responsive pic-bordered"                                                 alt="{{ seance.film.title }}">                                        {% endif %}                                        <div class="btn-group btn-group btn-group-justified">                                            {% if app.user is defined  and app.user.id is defined %}                                                {% if app.user.id == seance.creator.id %}                                                    <a href=""                                                       class="cbp-lightbox cbp-l-caption-buttonRight btn yellow-lemon btn-sm "                                                       data-title="{{ seance.film.title }}">                                                        <i class="fa fa-edit fa-fw"></i> Modifier                                                    </a>                                                {% elseif isParticipant is defined and isParticipant  == true %}                                                    <a href="javascript:;"                                                       data-action="btn-message"                                                       class="btn green-meadow btn-sm btn-block">                                                        <i class="fa fa-envelop"></i> Message                                                    </a>                                                {% else %}                                                    <a href="{{ path('user_participate',{ 'seance': seance.id }) }}"                                                       data-action="btn-participation"                                                       class="btn green-meadow btn-sm">                                                        <i class="fa fa-shopping-cart fa-fw"></i> Participer                                                    </a>                                                {% endif %}                                            {% else %}                                                <a href="{{ path('user_participate',{ 'seance': seance.id }) }}"                                                   class="btn green-meadow btn-sm btn-login_"                                                   data-title="{{ seance.film.title }}">                                                    <i class="fa fa-shopping-cart fa-fw"></i> Participer</a>                                            {% endif %}                                            {% if seance.film.trailer is defined and seance.film.trailer %}                                                <a href=""                                                   data-trailer="{{ seance.film.trailer }}"                                                   class="btn green btn-sm btn-trailer"                                                   data-title="{{ seance.film.title }}">                                                    <i class="fa fa-play fa-fw"></i> Bande d'annonce </a>                                            {% endif %}                                        </div>                                    </div>                                </div>                            </div>                            {#{{ dump( app.user) }}#}                            <div class="col-sm-12">                                <h3 class="page-header caption font-yellow-casablanca sbold">Commentaires</h3>                            </div>                            <form role="form">                                <div class="form-body">                                    {#<div class="col-md-9">#}                                    {#<div class="form-group">#}                                    {#<label>Nom</label>#}                                    {#<div class="input-icon ">#}                                    {#<i class="fa fa-user"></i>#}                                    {#<input type="text" class="form-control"#}                                    {#placeholder="Nom ou nom@mail.fr">#}                                    {#</div>#}                                    {#</div>#}                                    {#</div>#}                                    <div class="col-md-9">                                        <ul class="chats" id="list_comments">                                            {% if comments is defined and comments %}                                                {% for comment in comments %}                                                    <li class="in">                                                        <img class="avatar" alt=""                                                             src="{{ asset('bundles/mc/themes/layouts/layout/img/avatar.png') }}"/>                                                        <div class="message">                                                            <a href="javascript:;"                                                               class="name"> {{ comment.user.username }}</a>                                                            <span class="datetime">{{ comment.user.username }} </span>                                                            <span class="body"> {{ comment.message }} </span>                                                        </div>                                                    </li>                                                {% endfor %}                                            {% endif %}                                        </ul>                                    </div>                                    <div id="comment_none" data-value='<li class="in">                                                <img class="avatar" alt=""                                                     src="{{ asset('bundles/mc/themes/layouts/layout/img/avatar.png') }}"/>                                                <div class="message">                                                    <a href="javascript:;" class="name"></a>                                                    <span class="datetime"></span>                                                    <span class="body"></span>                                                </div>                                            </li>'></div>                                    <div class="col-md-9">                                        <div class="alert alert-warning hide" id="comment_alert">                                            <a href="#" class="close" data-dismiss="alert"                                               aria-label="close">&times;</a>                                            <strong>Error:</strong> <span id="message_comment_alert"></span>                                        </div>                                        <div class="form-group">                                            <div class="input-icon ">                                                <i class="fa fa-list-alt"></i>                                                <textarea name="comment" class="form-control" id="text_comment"                                                          rows="3" autocomplete="off"></textarea>                                            </div>                                        </div>                                    </div>                                </div>                                <div class="col-md-9">                                    <div class="form-actions margin-bottom-20">                                        <button class="btn blue" type="button" id="btn_comment"                                                {% if seance is defined  and seance %}                                                    data-seance="seance_{{ seance.id }}"                                                {% endif %}                                        >Commenter                                        </button>                                        <button class="btn default" type="button">Annuler</button>                                    </div>                                </div>                            </form>                        </div>                        {#{{ dump(seance) }}#}                    </div>                {% endif %}            </div>        </div>    </div>    <div id="modal_trailer" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"         aria-hidden="true">        <div class="modal-dialog modal-lg">            <div class="modal-content bg-blue-ebonyclay bg-font-blue-ebonyclay">                <div class="modal-header" style="padding: 7px !important;">                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: #fff;">×                    </button>                    {% if seance.film.title is defined %}                        <h4>Bande Annonce: {{ seance.film.title | capitalize }}</h4>                    {% endif %}                </div>                <div class="modal-body bg-blue-ebonyclay" style="padding:0 !important; margin: 0 !important;">                    {#<div class="embed-responsive embed-responsive-4by3">#}                    <div class="embed-responsive embed-responsive-16by9">                        <iframe class="embed-responsive-item" frameborder="0" allowfullscreen=""></iframe>                    </div>                </div>            </div>        </div>    </div>    {% if app.user is not defined %}        <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"             aria-hidden="true" style="display: none;">            <div class="modal-dialog ">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span                                    aria-hidden="true">&times;</span></button>                        <h4 class="modal-title font-blue-steel">Veuillez se connecter pour participer à la séance</h4>                    </div>                    <div class="modal-body bg-white">                        {#style="padding:0 !important; margin: 0 !important;">#}                        <form class="form-horizontal" action="{{ path("fos_user_security_check") }}" method="post">                            <input type="hidden" name="_csrf_token" autocomplete="off"                            />                            {% if csrf_token is defined %}                                <input type="hidden" name="_csrf_token" value="{{ csrf_token }}"/>                            {% endif %}                            <div class="form-body">                                <div class="form-group">                                    <div class="col-sm-12">                                        {% if error is defined %}                                            <div class="alert alert-danger alert-dismissible fade in" role="alert">                                                <button type="button" class="close" data-dismiss="alert"                                                        aria-label="Close">                                                    <span aria-hidden="true">&times;</span>                                                </button>                                                {{ error.messageKey|trans(error.messageData, 'security') }}                                            </div>                                        {% endif %}                                    </div>                                    <div class="col-sm-12">                                        <label for="username"                                               class="control-label">{{ 'security.login.username'|trans }}</label>                                    </div>                                    <div class="col-sm-12">                                        <input type="text" id="username" name="_username"                                               class="form-control" required="required"                                               placeholder="{{ 'security.login.username'|trans }}"/>                                    </div>                                    <div class="col-sm-12">                                        <label for="password"                                               class="control-label">{{ 'security.login.password'|trans }}</label>                                    </div>                                    <div class="col-sm-12">                                        <input type="password" class="form-control" id="password" name="_password"                                               required="required" placeholder="********"                                               placeholder="{{ 'security.login.password'|trans }}"/>                                    </div>                                </div>                                <div class="form-group">                                    <div class="col-sm-6">                                        <div class="">                                            <label for="remember_me">                                                <input type="checkbox" id="remember_me"                                                       name="_remember_me" {#class="form-control"#}                                                       value="on"/> {{ 'security.login.remember_me'|trans }}                                            </label>                                        </div>                                    </div>                                    <div class="col-sm-6 text-right">                                        <p><a href="{{ path('fos_user_resetting_request') }}">Mot de passe perdu                                                ?</a>                                        </p>                                    </div>                                </div>                                <div class="form-group">                                    <div class="col-sm-3">                                        <input type="submit" id="_submit" name="_submit"                                               class="btn  btn-block btn-default"                                               value="{{ 'security.login.submit'|trans }}"/>                                    </div>                                </div>                            </div>                        </form>                        {#<div class="login-help">#}                        {#<a href="#">Register</a> - <a href="#">Forgot Password</a>#}                        {#</div>#}                    </div>                </div>            </div>        </div>        </div>    {% endif %}{% endblock %}    {% block javascripts %}        {{ parent() }}        {% javascripts        "bundles/mc/themes/global/plugins/datatables/datatables.min.js"        'bundles/mc/js/jquery.rateyo.min.js'        'bundles/mc/themes/global/plugins/cubeportfolio/js/jquery.cubeportfolio.min.js'        'bundles/mc/themes/pages/scripts/portfolio-1.js'        'bundles/mc/js/dataTable.js' %}        {#  #}        <script src="{{ asset_url }}"></script>        {% endjavascripts %}        <script>            $(function () {                $("#pressRating").rateYo({                    rating: parseFloat($('#pressRating').attr("data-rating")),                    readOnly: true,                    starWidth: "16px",                });                $("#userRating").rateYo({                    rating: parseFloat($('#userRating').attr("data-rating")),                    readOnly: true,                    starWidth: "16px",                });                $('.btn-trailer').click(function (e) {                    var src = $(this).attr("data-trailer");                    $('#modal_trailer').modal('show');                    $('#modal_trailer iframe').attr('src', src);                    e.preventDefault();                });                $('#modal_trailer button').click(function () {                    $('#modal_trailer iframe').removeAttr('src');                });                $('#btn_comment').click(function (e) {                    var message = $.trim($('#text_comment').val());                    var idSeance = $(this).data('seance').replace('seance_', '');                    console.log(idSeance);                    if (message.length > 3 && idSeance !== "undefined") {                        $.ajax({                            type: 'GET',                            url: '{{ path("seance_comment") }}',                            data: {seance: idSeance, message: message},                            dataType: "json",                            success: function (data, status, object) {                                console.log(data);                                var $comment = $("#comment_none").data("value");                                $comment.find('.name').html("yann");                                $comment.find('.datetime').html("10h 10");                                $comment.find('.body').html(message);                                $('#list_comments').append($comment);                                if (data.error) $('.error').html(data.message);                            },                            error: function (data, status, object) {                                console.log(data.message);                            }                        });                    } else {                        $('#comment_alert').removeClass('hide');                        if (message.length < 3) {                            $('#message_comment_alert').html("Vous devez renter 3 Caractères au minimum dans votre commentaire.");                        } else {                            $('#message_comment_alert').html("Vous devez être connecté(e).");                        }                    }                    console.log('commenter');                    e.preventDefault();                });                $('#_submit').click(function (e) {                    console.log("Submit");                    e.preventDefault();                    $.ajax({                        type: $('form').attr('method'),                        url: '{{ path("fos_user_security_check") }}',                        data: $('form').serialize(),                        dataType: "json",                        success: function (data, status, object) {                            console.log(data);                            if (data.error) $('.error').html(data.message);                        },                        error: function (data, status, object) {                            console.log(data.message);                        }                    });                });            });        </script>    {% endblock %}