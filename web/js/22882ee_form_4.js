var cache = {};$(function () {    $(".modality").change(function () {        console.log($(this).val());        switch ($(this).val()) {            case '1': //gratuit                $('#input_price').addClass("hide");                $('#input_contribution').addClass("hide");                break;            case '2' : //contribution                $('#input_price').addClass("hide");                $('#input_contribution').removeClass("hide");                break;            case '3' : // payant                $('#input_price').removeClass("hide");                $('#input_contribution').addClass("hide");                break;            case '4' : //payant avec contribution                $('#input_price').removeClass("hide");                $('#input_contribution').removeClass("hide");                break;        }    });    $("#search_film").keyup(function () {        console.log($(this).val().length);        if ($(this).val().length > 2) {            $("#btn_search_film").prop('disabled', false);        } else {            $("#btn_search_film").prop('disabled', true);        }    });    $("#search_film").change(function () {        $("#icon_search_film").removeClass("fa-spin").removeClass("fa-spinner").addClass("fa-film");        if (!$(this).val()) {            $('.input_film').val("");        }        if ($(this).val().length < 2) {            $("#btn_search_film").prop('disabled', true);        }    });    $("#search_film").autocomplete({        //source: availableTags        source: function (request, response) {            //Si la réponse est dans le cache            if (request.term in cache) {                response($.map(cache[request.term], function (item) {                    console.log(item);                    return {                        label: item.title,//+ ", " + item.code,                        value: function () {                            $("#search_film").val(item.title);                            $("#search_film").attr("data-value", item.code);                            return item.title;                        }                    };                }));            } else {                var href = Routing.generate('search_film_ajax');                var data = {search: $.trim($("#search_film").val())};                // $.getJSON(href, data)                $.ajax({                    url: href,                    dataType: "json",                    data: data,                    type: 'GET',                    beforeSend: function () {                        $("#icon_search_film").removeClass("fa-film")                            .addClass("fa-spin")                            .addClass("fa-spinner");                    }                }).done(function (data) {                    $("#icon_search_film")                        .removeClass("fa-spin")                        .removeClass("fa-spinner")                        .addClass("fa-film");                    if (data.response == "success") {                        if (!data.result.length) {                            var result = [                                {                                    label: 'Aucun film trouvé',                                    value: response.term                                }                            ];                            response(result);                        } else {                            // console.log(data);                            cache[request.term] = data.result;                            // console.log(data.result);                            response($.map(data.result, function (item) {                                // console.log(item);                                return {                                    label: item.title,// + "(" + item.code + ")",                                    avatar: item.poster,                                    value: function () {                                        $("#search_film").val(item.title);                                        $('.input_film').val(item.code);                                        $("#search_film").attr("data-value", item.code);                                        return item.title;                                    }                                };                            }));                        }                    }                });            }        },        minLength: 2,        delay: 10    }).data("uiAutocomplete")._renderItem = function (ul, item) {        var $img = $('<img>');        $img.attr({            src: item.avatar,            alt: item.label        }).addClass('autocomplete-image');        var $li = $('<li>'),            $link = $('<a href="#"  data-toggle="tooltip" >');        $link.append($img).append(item.label);        $li.attr('data-value', item.label);        $li.append($link);        return $li.appendTo(ul);    };    $('.btn-add-user').click(function (e) {        $('.input_date_session').val($("#input_date_session").val());        //e.preventDefault();    });    $('#btn_search_film').click(function (e) {        var search = $.trim($("#search_film").val());        if (search.length > 2) {            searchFilmAjax(search);            $('#modal_search_film').modal();        }        e.preventDefault();    });    function searchFilmAjax(search) {        $("#result_film").html("");        var $row = $('<div class="row">');        var href = Routing.generate('search_film_ajax');        var data = {search: search, count: 24};        $.ajax({            url: href,            dataType: "json",            data: data,            type: 'GET',            beforeSend: function () {                $("#icon_search_film").removeClass("fa-film")                    .addClass("fa-spin")                    .addClass("fa-spinner");            }        }).done(function (data) {            $("#icon_search_film")                .removeClass("fa-spin")                .removeClass("fa-spinner")                .addClass("fa-film");            if (data.response == "success") {                console.log(data);                $.each(data.result, function (key, video) {                    if (video.poster != null && video.title != null) {                        var $col = $('<div class="col-sm-2 text-center">');                        var $img = $('<img src="' + video.poster + '"  tile="' + video.title + '" class="image-responsive" height="160" width="120" />');                        $col.html($img);                        $row.append($col);                        $("#result_film").append($row);                    }                });                // console.log($row);            } else {                $("#result_film").append($row.append('<h4> Aucun film trouvé.</h4>'));            }        });    }});